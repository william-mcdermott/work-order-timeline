<div class="page" (click)="onGlobalClick()">
  <header class="app-header">
    <div class="brand">NAOLOGIC</div>

    <div class="header-row">
      <h1 class="title">{{ title }}</h1>
    </div>

    <div class="controls">
      <div class="timescale-pill" (click)="toggleTimescale($event)">
        <span class="pill-label">Timescale</span>
        <span class="pill-value">{{ timescaleLabel }}</span>
        <span class="chevron" aria-hidden="true"></span>

        <div class="timescale-menu" *ngIf="timescaleOpen" (click)="$event.stopPropagation()">
          <button
            type="button"
            class="menu-item"
            *ngFor="let opt of timescaleOptions"
            [class.is-selected]="opt.value === timescale"
            [class.is-disabled]="opt.value === 'hour'"
            (click)="selectTimescale(opt.value, $event)"
          >
            {{ opt.label }}
          </button>
        </div>
      </div>
      <button class="today-btn" type="button" (click)="goToToday($event)">Today</button>
    </div>
  </header>

  <section class="card">
    <div class="timeline__grid">
      <div class="timeline__left">
        <div class="header__cell">Work Center</div>
        <div class="row-left" *ngFor="let wc of workCenters; trackBy: trackById">
          {{ wc.name }}
        </div>
      </div>

      <div class="timeline__right">
        <div class="scroll" #scrollEl>
          <div class="scroll__content" [style.width.px]="totalWidthPx()">
            <app-timeline-header [columns]="headerColumns()"></app-timeline-header>

            <app-timeline-grid
              [workCenters]="workCenters"
              [columns]="gridColumns()"
              [bars]="barsVm()"
              [pixelsPerDay]="pixelsPerDay"
              [openMenuBarId]="openMenuBarId"
              (rowClick)="openCreateFromClick($event.workCenterId, $event.event)"
              (toggleMenu)="onToggleMenu($event)"
              (edit)="openEdit($event)"
              (delete)="deleteBar($event)"
            ></app-timeline-grid>

            <div class="today-line" [style.left.px]="todayLineLeftPx()"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Global fixed-position menu (NOT inside tinted row/bar) -->
  <div
    class="floating-menu"
    *ngIf="openMenuBarId && menuRect"
    [style.left.px]="menuRect.left"
    [style.top.px]="menuRect.bottom + 8"
    (click)="$event.stopPropagation()"
  >
    <button type="button" (click)="openEdit(openMenuBarId!)">Edit</button>
    <button type="button" (click)="deleteBar(openMenuBarId!)">Delete</button>
  </div>

  <app-work-order-panel
    *ngIf="panelOpen && panelInitial"
    [mode]="panelMode"
    [initial]="panelInitial"
    [externalError]="panelExternalError"
    (changed)="onPanelChanged()"
    (close)="closePanel()"
    (submit)="onPanelSubmit($event)"
  ></app-work-order-panel>
</div>
