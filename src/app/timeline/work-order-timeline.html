<div class="page">
  <div class="topbar">
    <div class="topbar__title">{{ title }}</div>

    <div class="topbar__controls">
      <div class="label">Timescale:</div>

      <div class="seg">
        <button type="button" class="seg__btn" [class.is-active]="timescale==='day'" (click)="setTimescale('day')">Day</button>
        <button type="button" class="seg__btn" [class.is-active]="timescale==='week'" (click)="setTimescale('week')">Week</button>
        <button type="button" class="seg__btn" [class.is-active]="timescale==='month'" (click)="setTimescale('month')">Month</button>
      </div>
    </div>
  </div>

  <div class="timeline">
    <!-- HEADER -->
    <div class="timeline__header">
      <div class="header__left">
        <div class="header__cell">Work Center</div>
      </div>

      <div class="header__right">
        <div class="scroll" #scrollEl>
          <div class="grid-header" [style.width.px]="totalWidthPx()">
            <div
              class="col"
              *ngFor="let c of columns; trackBy: trackByCol"
              [style.width.px]="colWidthPx(c)"
            >
              {{ c.label }}
            </div>

            <div class="today-line" [style.left.px]="todayLineLeftPx()"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- BODY -->
    <div class="timeline__body">
      <div class="body__left">
        <div class="row-left" *ngFor="let wc of workCenters; trackBy: trackById">
          {{ wc.name }}
        </div>
      </div>

      <div class="body__right">
        <!-- reuse same scroll container: simplest is to wrap both header+body with one scroll later
             @upgrade: sync header/body scrollLeft; for now keep single scroll by using same element for both.
        -->
        <div class="scroll" [scrollLeft]="scrollEl?.nativeElement.scrollLeft">
          <div class="grid-body" [style.width.px]="totalWidthPx()">
            <div class="row" *ngFor="let wc of workCenters; trackBy: trackById">
              <div class="row-track">
                <div
                  class="cell"
                  *ngFor="let c of columns; trackBy: trackByCol"
                  [style.width.px]="colWidthPx(c)"
                ></div>

                <!-- HARD-CODED BARS (scaled by pixelsPerDay) -->
                <div
                  class="work-bar"
                  *ngFor="let bar of barsFor(wc.id); trackBy: trackByBar"
                  [style.left.px]="barLeftPx(bar)"
                  [style.width.px]="barWidthPx(bar)"
                >
                  <div class="work-bar__content">
                    <div class="work-bar__name" title="{{ bar.name }}">{{ bar.name }}</div>
                    <div class="status-pill" [attr.data-status]="bar.status">
                      {{ bar.status }}
                    </div>
                    <button type="button" class="dots" aria-label="Actions">â‹¯</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="today-line" [style.left.px]="todayLineLeftPx()"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
